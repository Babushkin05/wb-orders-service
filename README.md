# Демонстрационный сервис с Kafka, PostgreSQL, Redis -  WB техношкола

## Описание проекта

Данный сервис написан на Go с использованием чистой архитектуры и принципов SOLID.  
Основная задача — принимать данные о заказах из Kafka, сохранять в PostgreSQL, кэшировать в Redis и выдавать по HTTP-запросам.

---

## Ключевые особенности

- **Kafka + Inbox Processor**  
  Для обеспечения гарантии *at most once* обработки сообщений реализован паттерн inbox processor.

- **PostgreSQL**  
  Хранение заказов в реляционной базе данных. Поддержка миграций.

- **Redis**  
  Используется как кэш для быстрого доступа к данным заказов.

- **HTTP API + Swagger**  
  REST API с автоматической документацией через Swagger по адресу `/swagger/index.html`.

- **Отдельный генератор заказов**  
  Скрипт `order-generator` для эмуляции поступления заказов в Kafka.

- **Чистая архитектура**  
  Проект структурирован по слоям с соблюдением SOLID-принципов, что облегчает поддержку и расширение.

---

## Быстрый старт

### Предварительные требования

- Go (версия 1.20+)
- Docker и Docker Compose (для поднятия Kafka, PostgreSQL, Redis)
- Make

### Запуск сервисов зависимостей

```bash
make up
```

Это поднимет Kafka, PostgreSQL и Redis с нужными конфигурациями.

### Миграции базы данных

Для применения миграций выполните:

```bash
make docker-migrate-up
```

---

### Генерация Swagger

Для запуска основного сервиса выполните:

```bash
make swaga
```

### Запуск генератора заказов

Для имитации поступления заказов в Kafka:

```bash
make order-generator
```

---

## Использование API

- **Получение заказа по ID**

```
GET http://localhost:8080/order/<order_uid>
```

Возвращает JSON с данными заказа из кэша или БД.

- **Swagger UI**

Простой UI для ввода `order_uid` и отображения информации о заказе через API.

Доступен по адресу:

```
http://localhost:8080/swagger/index.html
```

---

## Архитектурные решения

- **Inbox Processor**  
  Обеспечивает идемпотентную обработку сообщений Kafka, позволяя избежать дублирования при сбоях.

- **Чистая архитектура и SOLID**  
  Отделение бизнес-логики от инфраструктурных деталей для улучшения тестируемости и поддержки.

---

## Makefile команды

- `make up` — запуск сервиса  
- `make order-generator` — запуск скрипта генерации заказов  
- `make docker-migrate-up` — применение миграций  
- `make docker-migrate-down` — откат миграций

---

## Логи и отладка

Логирование настроено согласно конфигурации в `config.yaml`. Ошибки подключения к Kafka, БД или Redis выводятся в логи с детальной информацией.

